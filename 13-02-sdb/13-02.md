# Домашнее задание к занятию "`Защита хоста`" - `Потапов Василий`

## Задание 1

1. Установите eCryptfs.
2. Добавьте пользователя cryptouser.
3. Зашифруйте домашний каталог пользователя с помощью eCryptfs.

В качестве ответа пришлите снимки экрана домашнего каталога пользователя с исходными и зашифрованными данными.

## Ответ 1

![alt text](https://github.com/mistermedved01/hw-13-02/blob/main/img/01.jpg)

## Задание 2

1. Установите поддержку LUKS.
2. Создайте небольшой раздел, например, 100 Мб.
3. Зашифруйте созданный раздел с помощью LUKS.

В качестве ответа пришлите снимки экрана с поэтапным выполнением задания.

## Ответ 2

### 1. Разметка диска

Запускаем утилиту parted, указав в качестве аргумента имя диска:

`parted /dev/sdb`

Таблица разделов должна быть размечена как GPT:

`(parted) mklabel gpt`

Создаем один основной раздел с номером 1, занимающий весь диск:

`(parted) mkpart primary 1 -1`

Выходим из утилиты parted:

`(parted) quit`

### 2. Создание ключа

Теперь необходимо создать 2048-битный ключ, указав его расположение:

`sudo dd if=/dev/urandom of=/root/secret.key bs=1024 count=2`

Изменить права файла, разрешив только чтение владельцу:

`sudo chmod 0400 /root/secret.key`

### 3. Создание и инициализация LUKS-раздела

Как правило утилита для шифрования дисков по-умолчанию уже установлена на Linux. Если она отсутствует, то установливаем

`sudo apt-get install cryptsetup`

При попытке доступа к вашему диску третьими лицами им необходимо иметь ключ для расшифрования данных на диске.

Создаем LUKS-раздел с использованием созданного ключа:

`cryptsetup luksFormat /dev/sdb1 /root/secret.key`

Появится предупреждение об уничтожении данных, большими буквами вводим `YES`

Свяжем ключ с разделом, что позже позволит его авторизовать раздел и скрыть подсказку пароля:

`cryptsetup luksAddKey /dev/sdb1 /root/secret.key --key-file=/root/secret.key`

Прежде чем начать использовать LUKS-раздел, его необходимо правильно отобразить и отформатировать. Для этого сначала используется опция luksOpen, которая создает устройство ввода-вывода, позволяющее взаимодействовать с разделом:

`cryptsetup luksOpen /dev/sdb1 secret --key-file=/root/secret.key`

Устройство ввода-вывода LUKS теперь доступно в /dev/mapper/secret.

Далее укажим размер раздела LUKS:

`cryptsetup resize secret`

При использовании опции resize без дополнительных переменных будет занят максимальный размер базового раздела.

Создаем файловую систему, например ext4:

`mkfs.ext4 /dev/mapper/secret`

Проверить состояние устройства можно с помощью следующей команды:

`cryptsetup -v status secret`

![alt text](https://github.com/mistermedved01/hw-13-02/blob/main/img/02.jpg)

Чтобы посмотреть информацию заголовка LUKS используем опцию luksDump:

`cryptsetup luksDump /dev/sdb1`

## 4. Монтирование LUKS-раздела

Создаем точку монтирования и устанавливаем права:

`sudo mkdir -p /secret`

`sudo chmod 755 /secret`

Примонтируем устройство LUKS:

`mount /dev/mapper/secret /secret`

Проверяем:

![alt text](https://github.com/mistermedved01/hw-13-02/blob/main/img/03.jpg)
